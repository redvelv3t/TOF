<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Time of Flight</title>

  <link rel="icon" href="Web-icon.JPEG" type="image/jpeg">
  <link rel="apple-touch-icon" href="Web-icon.JPEG">

  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <main class="wrap" id="app" aria-live="polite"></main>

  <script>
    const app = document.getElementById('app');

    function pad(n){ return String(n).padStart(2,'0'); }

    function ordinal(n){
      const s=["th","st","nd","rd"],v=n%100;
      return n+(s[(v-20)%10]||s[v]||s[0]);
    }

    function format(d){
      const m=["January","February","March","April","May","June","July","August","September","October","November","December"];
      const h24=d.getHours(), h12=(h24%12)||12;
      return `${m[d.getMonth()]} ${ordinal(d.getDate())} ${d.getFullYear()} ${h12}:${pad(d.getMinutes())}:${pad(d.getSeconds())}${h24>=12?'pm':'am'}`;
    }

    function windowFor(now){
      const y=now.getFullYear();
      const start=new Date(y,11,31,23,59,40);
      const midnight=new Date(y+1,0,1,0,0,0);
      const end=new Date(y+1,0,2,0,0,0);

      if(now<start) return {mode:'wait',next:start};
      if(now<midnight) return {mode:'countdown',midnight};
      if(now<end) return {mode:'celebrate',year:y+1};

      return {mode:'wait',next:new Date(y+1,11,31,23,59,40)};
    }

    function render(){
      const now=new Date();
      const w=windowFor(now);

      if(w.mode==='countdown'){
        const s=Math.max(0,Math.ceil((w.midnight-now)/1000));
        let c='white';
        if(s===3)c='bronze';
        if(s===2)c='silver';
        if(s===1)c='gold';

        app.className='wrap countdown';
        app.innerHTML=`
          <div class="card">
            <div class="hint">Time of Flight</div>
            <div class="timer ${c}">${s}</div>
          </div>`;
      }
      else if(w.mode==='celebrate'){
        app.className='wrap celebrate';
        app.innerHTML=`
          <div class="celebrate-inner">
            <div class="bigline">happy new year!</div>
            <div class="bigyear">${w.year}</div>
          </div>`;
      }
      else{
        app.className='wrap pre';
        app.innerHTML=`
          <div class="card">
            <div class="hint">Time of Flight</div>
            <div class="title">Come back</div>
            <div class="sub mono">${format(w.next)}</div>
          </div>`;
      }
    }

    render();
    setInterval(render,200);
  </script>
</body>
</html>
